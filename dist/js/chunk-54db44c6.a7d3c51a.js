(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-54db44c6"],{"0d7e":function(e,t,a){"use strict";var n=a("63fb"),i=a.n(n);i.a},"0dd4":function(e,t,a){"use strict";var n=a("2569"),i=a.n(n);i.a},"159b":function(e,t,a){var n=a("da84"),i=a("fdbc"),r=a("17c2"),o=a("9112");for(var c in i){var l=n[c],s=l&&l.prototype;if(s&&s.forEach!==r)try{o(s,"forEach",r)}catch(u){s.forEach=r}}},"17c2":function(e,t,a){"use strict";var n=a("b727").forEach,i=a("a640"),r=a("ae40"),o=i("forEach"),c=r("forEach");e.exports=o&&c?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},2569:function(e,t,a){},4160:function(e,t,a){"use strict";var n=a("23e7"),i=a("17c2");n({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},"63c5":function(e,t,a){},"63fb":function(e,t,a){},"65f0":function(e,t,a){var n=a("861d"),i=a("e8b5"),r=a("b622"),o=r("species");e.exports=function(e,t){var a;return i(e)&&(a=e.constructor,"function"!=typeof a||a!==Array&&!i(a.prototype)?n(a)&&(a=a[o],null===a&&(a=void 0)):a=void 0),new(void 0===a?Array:a)(0===t?0:t)}},"685c":function(e,t,a){"use strict";a.d(t,"d",(function(){return i})),a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return c}));var n=a("b6d1"),i=function(e){return Object(n["a"])({method:"GET",url:"/mp/v1_0/user/images",params:e})},r=function(e,t){return Object(n["a"])({method:"PUT",url:"/mp/v1_0/user/images/".concat(e),data:{collect:t}})},o=function(e){return Object(n["a"])({method:"DELETE",url:"/mp/v1_0/user/images/".concat(e)})},c=function(e){return Object(n["a"])({method:"POST",url:"/mp/v1_0/user/images",data:e})}},9002:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"material-img"},[a("div",{staticClass:"material-top"},[a("el-radio-group",{attrs:{size:"mini"},on:{change:e.onCollectChange},model:{value:e.collect,callback:function(t){e.collect=t},expression:"collect"}},[a("el-radio-button",{attrs:{label:!1}},[e._v("全部")]),a("el-radio-button",{attrs:{label:!0}},[e._v("收藏")])],1),e.isShowAdd?a("el-button",{attrs:{type:"info",round:"",size:"mini"},on:{click:function(t){e.dialogUploadVisible=!0}}},[e._v("上传素材")]):e._e()],1),a("div",{staticClass:"material-img"},[a("el-row",{attrs:{gutter:10}},e._l(e.images,(function(t,n){return a("el-col",{key:n,attrs:{xs:12,md:6,lg:4,sm:6},nativeOn:{click:function(t){return e.selectedImg(n)}}},[e.isShowCollect?a("div",{staticClass:"collectOrDelete"},[a("el-button",{attrs:{size:"mini",type:"warning",icon:t.is_collected?"el-icon-star-on":"el-icon-star-off",circle:"",loading:t.loading},on:{click:function(a){return e.onCollect(t)}}}),a("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete",circle:"",loading:t.loading},on:{click:function(a){return e.deleteItemImage(t)}}})],1):e._e(),a("el-image",{staticStyle:{height:"150px"},attrs:{src:t.url,fit:"cover"}}),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowBackground&&e.selected===n,expression:"isShowBackground && selected === index"}],staticClass:"selected"})],1)})),1)],1),a("el-dialog",{attrs:{title:"素材上传",visible:e.dialogUploadVisible,"append-to-body":!0},on:{"update:visible":function(t){e.dialogUploadVisible=t}}},[a("el-upload",{staticClass:"upload-demo",attrs:{drag:"",action:"http://ttapi.research.itcast.cn/mp/v1_0/user/images",headers:e.uploadHeader,name:"image","on-success":e.uploadSuccess,multiple:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),a("em",[e._v("点击上传")])]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过500kb")])])],1),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.totalCount,"current-page":e.page},on:{"current-change":e.onPageChange,"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t}}})],1)},i=[],r=(a("4160"),a("159b"),a("685c")),o={name:"MaterialImg",props:{isShowAdd:{type:Boolean,default:!0},isShowCollect:{type:Boolean,default:!0},isShowBackground:{type:Boolean,default:!1}},data:function(){var e=JSON.parse(window.localStorage.getItem("user"));return{collect:!1,images:[],dialogUploadVisible:!1,uploadHeader:{Authorization:"Bearer ".concat(e.token)},totalCount:0,page:1,selected:null}},created:function(){this.loadImages(1,!1)},methods:{loadImages:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.page=e,Object(r["d"])({collect:a,page:e,per_page:18}).then((function(e){var a=e.data.data.results;a.forEach((function(e){e.loading=!1})),t.images=a,t.totalCount=e.data.data.total_count}))},onCollectChange:function(e){this.loadImages(1,e)},uploadSuccess:function(){this.dialogUploadVisible=!1,this.loadImages(this.page),this.$message({type:"success",message:"上传成功"})},onPageChange:function(e){this.loadImages(e)},onCollect:function(e){e.loading=!0,e.is_collected,Object(r["a"])(e.id,!e.is_collected).then((function(t){e.is_collected=!e.is_collected,e.loading=!1}))},deleteItemImage:function(e){var t=this;e.loading=!0,Object(r["b"])(e.id).then((function(a){t.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loadImages(t.page),t.$message({type:"success",message:"删除成功!"}),e.loading=!1})).catch((function(){t.$message({type:"info",message:"已取消删除"}),e.loading=!1}))}))},selectedImg:function(e){this.selected=e}}},c=o,l=(a("0d7e"),a("2877")),s=Object(l["a"])(c,n,i,!1,null,"2472eb69",null);t["a"]=s.exports},a640:function(e,t,a){"use strict";var n=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&n((function(){a.call(null,t||function(){throw 1},1)}))}},ae40:function(e,t,a){var n=a("83ab"),i=a("d039"),r=a("5135"),o=Object.defineProperty,c={},l=function(e){throw e};e.exports=function(e,t){if(r(c,e))return c[e];t||(t={});var a=[][e],s=!!r(t,"ACCESSORS")&&t.ACCESSORS,u=r(t,0)?t[0]:l,d=r(t,1)?t[1]:void 0;return c[e]=!!a&&!i((function(){if(s&&!n)return!0;var e={length:-1};s?o(e,1,{enumerable:!0,get:l}):e[1]=1,a.call(e,u,d)}))}},b39d:function(e,t,a){"use strict";var n=a("63c5"),i=a.n(n);i.a},b727:function(e,t,a){var n=a("0366"),i=a("44ad"),r=a("7b0b"),o=a("50c4"),c=a("65f0"),l=[].push,s=function(e){var t=1==e,a=2==e,s=3==e,u=4==e,d=6==e,f=5==e||d;return function(m,p,g,h){for(var v,b,_=r(m),w=i(_),y=n(p,g,3),C=o(w.length),x=0,$=h||c,O=t?$(m,C):a?$(m,0):void 0;C>x;x++)if((f||x in w)&&(v=w[x],b=y(v,x,_),e))if(t)O[x]=b;else if(b)switch(e){case 3:return!0;case 5:return v;case 6:return x;case 2:l.call(O,v)}else if(u)return!1;return d?-1:s||u?u:O}};e.exports={forEach:s(0),map:s(1),filter:s(2),some:s(3),every:s(4),find:s(5),findIndex:s(6)}},bc53:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"articles-container"},[a("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("首页")]),a("el-breadcrumb-item",[e._v(e._s(this.$route.query.id?"修改文章":"发布文章")+" ")])],1)],1),a("div",[a("el-form",{ref:"publish-form",staticClass:"articles-form",attrs:{model:e.articles,"label-width":"80px",rules:e.formRules}},[a("el-form-item",{attrs:{label:"标题",prop:"title"}},[a("el-input",{model:{value:e.articles.title,callback:function(t){e.$set(e.articles,"title",t)},expression:"articles.title"}})],1),a("el-form-item",{attrs:{label:"内容",prop:"content"}},[a("el-tiptap",{attrs:{extensions:e.extensions},model:{value:e.articles.content,callback:function(t){e.$set(e.articles,"content",t)},expression:"articles.content"}})],1),a("el-form-item",{attrs:{label:"封面",prop:"cover"}},[a("el-radio-group",{model:{value:e.articles.cover.type,callback:function(t){e.$set(e.articles.cover,"type",t)},expression:"articles.cover.type"}},[a("el-radio",{attrs:{label:1}},[e._v("单图")]),a("el-radio",{attrs:{label:3}},[e._v("三图")]),a("el-radio",{attrs:{label:0}},[e._v("无图")]),a("el-radio",{attrs:{label:-1}},[e._v("自动")])],1),[e.articles.cover.type>0?a("div",{staticClass:"coverImage"},e._l(e.articles.cover.type,(function(t,n){return a("articles-cover",{key:n,staticClass:"item",model:{value:e.articles.cover.images[n],callback:function(t){e.$set(e.articles.cover.images,n,t)},expression:"articles.cover.images[index]"}})})),1):e._e()]],2),a("el-form-item",{attrs:{label:"频道",prop:"channel_id"}},[a("el-select",{attrs:{placeholder:"请选择频道"},model:{value:e.articles.channel_id,callback:function(t){e.$set(e.articles,"channel_id",t)},expression:"articles.channel_id"}},e._l(e.channels,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onPublish(!1)}}},[e._v(e._s(this.$route.query.id?"修改":"发布"))]),a("el-button",{on:{click:function(t){return e.onPublish(!0)}}},[e._v("存入草稿")])],1)],1)],1)])],1)},i=[],r=a("cc48"),o=a("4ccc"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"articles-cover"},[a("div",{staticClass:"coverImgBox",on:{click:e.showDialogVisible}},[a("span",{directives:[{name:"show",rawName:"v-show",value:e.uploadText,expression:"uploadText"}],staticClass:"uploadText"},[e._v("点击上传封面")]),a("img",{ref:"cover-img",attrs:{src:e.value}})]),a("el-dialog",{attrs:{title:"请选择封面图片",visible:e.dialogVisible,width:"75%","append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-tabs",{attrs:{type:"card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"素材库",name:"first"}},[a("material-img",{ref:"img-list",attrs:{isShowAdd:!1,isShowCollect:!1,isShowBackground:!0}})],1),a("el-tab-pane",{attrs:{label:"手动上传",name:"second"}},[a("input",{ref:"file",attrs:{type:"file"},on:{change:e.changeImage}}),a("img",{ref:"reviewCoverImage",attrs:{width:"170",height:"150"}})])],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary",loading:e.unloadLoading},on:{click:e.unloadCoverImage}},[e._v("确 定")])],1)],1)],1)},l=[],s=(a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("685c")),u=a("9002"),d={name:"ArticlesCover",components:{MaterialImg:u["a"]},props:["value"],data:function(){return{dialogVisible:!1,activeName:"first",unloadLoading:!1,uploadText:!0}},computed:{},watch:{},methods:{showDialogVisible:function(){this.dialogVisible=!0,this.uploadText=!1},changeImage:function(){var e=this.$refs.file.files[0],t=window.URL.createObjectURL(e);this.$refs["reviewCoverImage"].src=t},unloadCoverImage:function(){var e=this;if(this.unloadLoading=!0,"second"===this.activeName){var t=this.$refs.file.files[0];if(!t)return void this.$message("请先选择文件");var a=new FormData;a.append("image",t),Object(s["c"])(a).then((function(t){e.unloadLoading=!1,e.dialogVisible=!1,e.$refs["cover-img"].src=t.data.data.url,e.$emit("input",t.data.data.url)}))}else if("first"===this.activeName){var n=this.$refs["img-list"],i=n.selected;if(null==i)return void this.$message("请先选择文件");this.unloadLoading=!1,this.dialogVisible=!1,this.$emit("input",n.images[i].url)}}},created:function(){},mounted:function(){},activated:function(){}},f=d,m=(a("b39d"),a("2877")),p=Object(m["a"])(f,c,l,!1,null,"10a7d035",null),g=p.exports,h={name:"Articles",components:{"el-tiptap":o["d"],ArticlesCover:g},props:{},data:function(){return{channels:[],articles:{title:"",content:"",cover:{type:1,images:[]},channel_id:null},formRules:{title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:5,max:30,message:"长度在 5 到 30 个字符",trigger:"blur"}],content:[{validator:function(e,t,a){"<p></p>"===t?a(new Error("请输入文章内容")):a()}},{required:!0,message:"请输入文章内容"}],channel_id:[{required:!0,message:"请选择频道"}]},extensions:[new o["c"],new o["n"],new o["l"],new o["h"],new o["g"]({level:3}),new o["a"]({bubble:!0}),new o["o"]({bubble:!0,menubar:!1}),new o["i"],new o["m"],new o["j"],new o["b"],new o["k"],new o["f"]]}},computed:{},watch:{},methods:{onPublish:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$refs["publish-form"].validate((function(a){a&&(e.$route.query.id?Object(r["g"])(e.$route.query.id,e.articles,t).then((function(a){console.log(a),e.$message({message:"".concat(t?"存入草稿":"修改"," 成功"),type:"success"}),e.$router.push("/content")})):Object(r["a"])(e.articles,t).then((function(a){e.$message({message:"".concat(t?"存入草稿":"发布"," 成功"),type:"success"}),e.$router.push("/content")})))}))},loadChannels:function(){var e=this;Object(r["f"])().then((function(t){e.channels=t.data.data.channels}))},loadArticle:function(){var e=this;Object(r["d"])(this.$route.query.id).then((function(t){e.articles=t.data.data}))},coverImg:function(e,t){this.articles.cover.images[e]=t}},created:function(){this.loadChannels(),this.$route.query.id&&this.loadArticle()},mounted:function(){},activated:function(){}},v=h,b=(a("0dd4"),Object(m["a"])(v,n,i,!1,null,"47838388",null));t["default"]=b.exports},cc48:function(e,t,a){"use strict";a.d(t,"e",(function(){return i})),a.d(t,"f",(function(){return r})),a.d(t,"a",(function(){return o})),a.d(t,"c",(function(){return c})),a.d(t,"g",(function(){return l})),a.d(t,"d",(function(){return s})),a.d(t,"b",(function(){return u}));var n=a("b6d1"),i=function(e){return Object(n["a"])({method:"GET",url:"/mp/v1_0/articles",params:e})},r=function(){return Object(n["a"])({method:"GET",url:"/mp/v1_0/channels"})},o=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(n["a"])({method:"POST",url:"/mp/v1_0/articles",params:{draft:t},data:e})},c=function(e){return Object(n["a"])({method:"DELETE",url:"/mp/v1_0/articles/".concat(e)})},l=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(n["a"])({method:"PUT",url:"/mp/v1_0/articles/".concat(e),params:{draft:a},data:t})},s=function(e){return Object(n["a"])({method:"GET",url:"/mp/v1_0/articles/".concat(e)})},u=function(e,t){return Object(n["a"])({method:"PUT",url:"/mp/v1_0/comments/status",params:{article_id:e},data:{allow_comment:t}})}},e8b5:function(e,t,a){var n=a("c6b6");e.exports=Array.isArray||function(e){return"Array"==n(e)}}}]);
//# sourceMappingURL=chunk-54db44c6.a7d3c51a.js.map